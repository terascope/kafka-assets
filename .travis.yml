language: node_js
node_js:
  - "8"
  - "10"
os:
  - linux
  - osx
branches:
  only:
  - master
  - /^v\d+\.\d+\.\d+/
before_install:
  # Install Kafka
  - wget http://www.us.apache.org/dist/kafka/2.11-1.1.0/kafka_2.11-1.1.0.tgz -O kafka.tgz
  - mkdir -p kafka && tar xzf kafka.tgz -C kafka --strip-components 1
  - cd kafka
  - echo "auto.create.topics.enable=true" >> config/server.properties
  # Run Zookeeper/Kafka on localhost (default ports for ZK, Kafka: 2181, 9092)
  - ./bin/zookeeper-server-start.sh config/zookeeper.properties &
  - sleep 3
  - ./bin/kafka-server-start.sh config/server.properties &
before_deploy: yarn build
deploy:
  provider: releases
  api_key: $GITHUB_TOKEN
  file_glob: true
  file: builds/*.zip
  skip_cleanup: true
  on:
    tags: true
